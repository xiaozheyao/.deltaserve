adapted from https://github.com/ray-project/ray-llm/commit/9251fb5829cf0e70ce058a9d293a41e2013325d3